<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãŠçŸ¥ã‚‰ã›æ²ç¤ºæ¿ - CE web App v3</title>
    <link rel="stylesheet" href="theme-unified.css">
    <style>
        .announcements-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e0e0e0;
        }

        .header-section h1 {
            margin: 0;
            color: #333;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .btn-primary {
            background-color: #4CAF50;
            color: white;
        }

        .btn-primary:hover {
            background-color: #45a049;
        }

        .btn-secondary {
            background-color: #2196F3;
            color: white;
        }

        .btn-secondary:hover {
            background-color: #0b7dda;
        }

        .btn-danger {
            background-color: #f44336;
            color: white;
        }

        .btn-danger:hover {
            background-color: #da190b;
        }

        .categories-section {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
        }

        .categories-sidebar {
            width: 250px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
            height: fit-content;
        }

        .categories-sidebar h3 {
            margin-top: 0;
            margin-bottom: 15px;
            color: #333;
            font-size: 16px;
        }

        .category-item {
            padding: 10px 15px;
            margin-bottom: 5px;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .category-item:hover {
            background-color: #f5f5f5;
        }

        .category-item.active {
            background-color: #e3f2fd;
            color: #2196F3;
            font-weight: bold;
        }

        .category-badge {
            background-color: #ff5722;
            color: white;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 12px;
            font-weight: bold;
        }

        .threads-section {
            flex: 1;
        }

        .thread-card {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .thread-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
        }

        .thread-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 10px;
        }

        .thread-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin: 0 0 5px 0;
        }

        .thread-meta {
            display: flex;
            gap: 15px;
            font-size: 13px;
            color: #666;
            align-items: center;
        }

        .thread-author {
            font-weight: 500;
        }

        .thread-date {
            color: #999;
        }

        .thread-category-tag {
            background-color: #e3f2fd;
            color: #2196F3;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .thread-content {
            color: #555;
            line-height: 1.6;
            margin-bottom: 10px;
        }

        .thread-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 10px;
            border-top: 1px solid #eee;
        }

        .thread-stats {
            display: flex;
            gap: 20px;
            font-size: 13px;
            color: #666;
        }

        .stat-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .attachment-icon {
            color: #2196F3;
        }

        .new-badge {
            background-color: #ff5722;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
        }

        /* ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¹ã‚¿ã‚¤ãƒ« */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal.active {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 8px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            margin: 0;
            color: #333;
        }

        .close-btn {
            font-size: 28px;
            font-weight: bold;
            color: #999;
            cursor: pointer;
            border: none;
            background: none;
        }

        .close-btn:hover {
            color: #333;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            box-sizing: border-box;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 150px;
        }

        .file-upload-area {
            border: 2px dashed #ddd;
            border-radius: 5px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-upload-area:hover {
            border-color: #2196F3;
            background-color: #f5f5f5;
        }

        .category-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .category-edit-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin-bottom: 5px;
            background-color: #f5f5f5;
            border-radius: 5px;
        }

        .category-edit-item input {
            flex: 1;
            margin-right: 10px;
        }

        .icon {
            margin-right: 5px;
        }

        /* ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            .categories-section {
                flex-direction: column;
            }

            .categories-sidebar {
                width: 100%;
            }

            .header-section {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .action-buttons {
                width: 100%;
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="announcements-container">
        <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="header-section">
            <div>
                <h1>ğŸ“¢ ãŠçŸ¥ã‚‰ã›æ²ç¤ºæ¿</h1>
                <p style="color: #666; margin: 5px 0 0 0;">éƒ¨é–€ã‚„æ¥­å‹™ã‚«ãƒ†ã‚´ãƒªã”ã¨ã®æƒ…å ±å…±æœ‰</p>
            </div>
            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="openCategoryModal()">
                    ğŸ“ ã‚«ãƒ†ã‚´ãƒªç®¡ç†
                </button>
                <button class="btn btn-primary" onclick="openNewThreadModal()">
                    âœï¸ æ–°è¦æŠ•ç¨¿
                </button>
                <button class="btn btn-secondary" onclick="location.href='home.html'">
                    ğŸ  ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹
                </button>
            </div>
        </div>

        <!-- ã‚«ãƒ†ã‚´ãƒªã¨ã‚¹ãƒ¬ãƒƒãƒ‰è¡¨ç¤ºã‚¨ãƒªã‚¢ -->
        <div class="categories-section">
            <!-- ã‚«ãƒ†ã‚´ãƒªã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
            <div class="categories-sidebar">
                <h3>ğŸ“‚ ã‚«ãƒ†ã‚´ãƒª</h3>
                <div id="categoryList">
                    <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                </div>
            </div>

            <!-- ã‚¹ãƒ¬ãƒƒãƒ‰ä¸€è¦§ -->
            <div class="threads-section">
                <div id="threadsList">
                    <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>

    <!-- æ–°è¦æŠ•ç¨¿ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="newThreadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âœï¸ æ–°è¦æŠ•ç¨¿</h2>
                <button class="close-btn" onclick="closeNewThreadModal()">&times;</button>
            </div>
            <form id="newThreadForm">
                <div class="form-group">
                    <label for="threadCategory">ã‚«ãƒ†ã‚´ãƒª *</label>
                    <select id="threadCategory" required>
                        <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="threadTitle">ã‚¿ã‚¤ãƒˆãƒ« *</label>
                    <input type="text" id="threadTitle" placeholder="æŠ•ç¨¿ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›" required>
                </div>
                <div class="form-group">
                    <label for="threadContent">å†…å®¹ *</label>
                    <textarea id="threadContent" placeholder="æŠ•ç¨¿å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..." required></textarea>
                </div>
                <div class="form-group">
                    <label for="threadFile">ãƒ•ã‚¡ã‚¤ãƒ«æ·»ä»˜ï¼ˆä»»æ„ï¼‰</label>
                    <div class="file-upload-area" onclick="document.getElementById('threadFile').click()">
                        <p>ğŸ“ ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</p>
                        <p style="font-size: 12px; color: #999;">PDFã€ç”»åƒã€Excel ãªã©</p>
                        <input type="file" id="threadFile" style="display: none;" accept=".pdf,.jpg,.jpeg,.png,.xlsx,.docx">
                    </div>
                    <p id="fileName" style="margin-top: 10px; color: #666; font-size: 13px;"></p>
                </div>
                <div style="display: flex; gap: 10px; justify-content: flex-end;">
                    <button type="button" class="btn btn-secondary" onclick="closeNewThreadModal()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                    <button type="submit" class="btn btn-primary">æŠ•ç¨¿ã™ã‚‹</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ã‚«ãƒ†ã‚´ãƒªç®¡ç†ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“ ã‚«ãƒ†ã‚´ãƒªç®¡ç†</h2>
                <button class="close-btn" onclick="closeCategoryModal()">&times;</button>
            </div>
            <div class="form-group">
                <label>æ—¢å­˜ã‚«ãƒ†ã‚´ãƒª</label>
                <ul class="category-list" id="categoryEditList">
                    <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
                </ul>
            </div>
            <div class="form-group">
                <label for="newCategoryName">æ–°ã—ã„ã‚«ãƒ†ã‚´ãƒªã‚’è¿½åŠ </label>
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="newCategoryName" placeholder="ã‚«ãƒ†ã‚´ãƒªåã‚’å…¥åŠ›">
                    <button class="btn btn-primary" onclick="addNewCategory()">è¿½åŠ </button>
                </div>
            </div>
            <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
                <button class="btn btn-secondary" onclick="closeCategoryModal()">é–‰ã˜ã‚‹</button>
            </div>
        </div>
    </div>

    <!-- ã‚¹ãƒ¬ãƒƒãƒ‰è©³ç´°ãƒ¢ãƒ¼ãƒ€ãƒ« -->
    <div id="threadDetailModal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h2 id="detailThreadTitle"></h2>
                <button class="close-btn" onclick="closeThreadDetailModal()">&times;</button>
            </div>
            <div id="threadDetailContent">
                <!-- JavaScriptã§å‹•çš„ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script>
        // ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿
        let categories = [
            { id: 'important', name: 'ğŸ”´ é‡è¦ãªãŠçŸ¥ã‚‰ã›', count: 2 },
            { id: 'all', name: 'ğŸ“¢ å…¨ä½“æ¥­å‹™é€£çµ¡', count: 3 },
            { id: 'field', name: 'ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚µãƒãƒ¼ãƒˆéƒ¨', count: 5 },
            { id: 'customer', name: 'ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆéƒ¨', count: 4 },
            { id: 'sales', name: 'å–¶æ¥­éƒ¨', count: 2 },
            { id: 'tech', name: 'æŠ€è¡“éƒ¨', count: 3 }
        ];

        let threads = [
            {
                id: 1,
                category: 'important',
                title: 'ã€é‡è¦ã€‘ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã®ãŠçŸ¥ã‚‰ã›',
                author: 'å±±ç”°å¤ªéƒï¼ˆç®¡ç†è€…ï¼‰',
                date: '2026-02-04 09:30',
                content: '2æœˆ10æ—¥ï¼ˆæœˆï¼‰22:00ã€œ24:00ã«ã‚·ã‚¹ãƒ†ãƒ ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’å®Ÿæ–½ã—ã¾ã™ã€‚ã“ã®é–“ã€ã‚·ã‚¹ãƒ†ãƒ ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒã§ããªããªã‚Šã¾ã™ã®ã§ã€ã”æ³¨æ„ãã ã•ã„ã€‚',
                replies: 8,
                views: 124,
                hasAttachment: true,
                isNew: true
            },
            {
                id: 2,
                category: 'important',
                title: 'æ–°å‹ã‚³ãƒ­ãƒŠã‚¦ã‚¤ãƒ«ã‚¹å¯¾å¿œã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³æ›´æ–°',
                author: 'ä½è—¤èŠ±å­ï¼ˆäººäº‹éƒ¨ï¼‰',
                date: '2026-02-03 14:20',
                content: 'åšç”ŸåŠ´åƒçœã®æŒ‡é‡å¤‰æ›´ã«ä¼´ã„ã€å½“ç¤¾ã®å¯¾å¿œã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ã‚’æ›´æ–°ã—ã¾ã—ãŸã€‚æ·»ä»˜ã®PDFã‚’ã”ç¢ºèªãã ã•ã„ã€‚',
                replies: 15,
                views: 256,
                hasAttachment: true,
                isNew: true
            },
            {
                id: 3,
                category: 'all',
                title: '2æœˆåº¦å…¨ä½“ä¼šè­°ã®è­°äº‹éŒ²',
                author: 'éˆ´æœ¨ä¸€éƒï¼ˆç·å‹™éƒ¨ï¼‰',
                date: '2026-02-02 16:45',
                content: '2æœˆ1æ—¥ã«å®Ÿæ–½ã•ã‚ŒãŸå…¨ä½“ä¼šè­°ã®è­°äº‹éŒ²ã‚’å…±æœ‰ã—ã¾ã™ã€‚å„éƒ¨é–€ã®å ±å‘Šäº‹é …ã¨ä»Šæœˆã®é‡ç‚¹é …ç›®ã‚’ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚',
                replies: 6,
                views: 89,
                hasAttachment: true,
                isNew: false
            },
            {
                id: 4,
                category: 'field',
                title: 'é¡§å®¢å…ˆè¨ªå•æ™‚ã®æ–°ã—ã„å ±å‘Šãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ',
                author: 'ç”°ä¸­æ¬¡éƒï¼ˆFSéƒ¨ï¼‰',
                date: '2026-02-01 11:20',
                content: 'è¨ªå•å ±å‘Šã®åŠ¹ç‡åŒ–ã®ãŸã‚ã€æ–°ã—ã„ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’å°å…¥ã—ã¾ã™ã€‚Excelå½¢å¼ã§æ·»ä»˜ã—ã¦ã„ã¾ã™ã®ã§ã€ä»Šå¾Œã¯ã“ã¡ã‚‰ã‚’ã”ä½¿ç”¨ãã ã•ã„ã€‚',
                replies: 12,
                views: 167,
                hasAttachment: true,
                isNew: false
            },
            {
                id: 5,
                category: 'customer',
                title: 'Q1ã®ã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚µãƒãƒ¼ãƒˆå¯¾å¿œçŠ¶æ³',
                author: 'é«˜æ©‹ç¾å’²ï¼ˆCSéƒ¨ï¼‰',
                date: '2026-01-31 10:15',
                content: 'ç¬¬1å››åŠæœŸã®ã‚µãƒãƒ¼ãƒˆå¯¾å¿œå®Ÿç¸¾ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚å•ã„åˆã‚ã›ä»¶æ•°ã€è§£æ±ºç‡ã€é¡§å®¢æº€è¶³åº¦ãªã©ã®æŒ‡æ¨™ã‚’å ±å‘Šã—ã¾ã™ã€‚',
                replies: 9,
                views: 143,
                hasAttachment: true,
                isNew: false
            },
            {
                id: 6,
                category: 'all',
                title: 'ç¤¾å†…ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–ã«ã¤ã„ã¦',
                author: 'ä¼Šè—¤å¥å¤ªï¼ˆæƒ…å ±ã‚·ã‚¹ãƒ†ãƒ éƒ¨ï¼‰',
                date: '2026-01-30 09:00',
                content: 'ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å‘ä¸Šã®ãŸã‚ã€VPNæ¥ç¶šã®äºŒæ®µéšèªè¨¼ã‚’å°å…¥ã—ã¾ã™ã€‚è¨­å®šæ–¹æ³•ã¯æ·»ä»˜ã®æ‰‹é †æ›¸ã‚’ã”å‚ç…§ãã ã•ã„ã€‚',
                replies: 20,
                views: 312,
                hasAttachment: true,
                isNew: false
            },
            {
                id: 7,
                category: 'field',
                title: 'æ–°è£½å“ç ”ä¿®ä¼šã®æ—¥ç¨‹ã«ã¤ã„ã¦',
                author: 'æ¸¡è¾ºèª ï¼ˆFSéƒ¨ï¼‰',
                date: '2026-01-29 15:30',
                content: '3æœˆã«ç™ºå£²äºˆå®šã®æ–°è£½å“ã«é–¢ã™ã‚‹ç ”ä¿®ä¼šã‚’2æœˆä¸­æ—¬ã«å®Ÿæ–½ã—ã¾ã™ã€‚æ—¥ç¨‹èª¿æ•´ã®ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã«ã”å”åŠ›ãã ã•ã„ã€‚',
                replies: 7,
                views: 98,
                hasAttachment: false,
                isNew: false
            },
            {
                id: 8,
                category: 'sales',
                title: '1æœˆåº¦ã®å–¶æ¥­å®Ÿç¸¾å ±å‘Š',
                author: 'ä¸­æ‘è£•å­ï¼ˆå–¶æ¥­éƒ¨ï¼‰',
                date: '2026-01-28 17:00',
                content: '1æœˆã®å–¶æ¥­å®Ÿç¸¾ã‚’ã¾ã¨ã‚ã¾ã—ãŸã€‚ç›®æ¨™é”æˆç‡ã‚„ä¸»è¦æ¡ˆä»¶ã®é€²æ—çŠ¶æ³ã‚’å…±æœ‰ã—ã¾ã™ã€‚',
                replies: 5,
                views: 76,
                hasAttachment: true,
                isNew: false
            }
        ];

        let currentUser = null;
        let selectedCategory = 'all';

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // LocalStorageã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—
            const userDataStr = localStorage.getItem('currentUser');
            if (userDataStr) {
                currentUser = JSON.parse(userDataStr);
            } else {
                currentUser = { name: 'ã‚²ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼', role: 'user' };
            }

            renderCategories();
            renderThreads();
            updateCategorySelect();

            // ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠæ™‚ã®å‡¦ç†
            document.getElementById('threadFile').addEventListener('change', function(e) {
                const fileName = e.target.files[0]?.name || '';
                document.getElementById('fileName').textContent = fileName ? `é¸æŠä¸­: ${fileName}` : '';
            });

            // æ–°è¦æŠ•ç¨¿ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡
            document.getElementById('newThreadForm').addEventListener('submit', function(e) {
                e.preventDefault();
                createNewThread();
            });
        });

        // ã‚«ãƒ†ã‚´ãƒªè¡¨ç¤º
        function renderCategories() {
            const categoryList = document.getElementById('categoryList');
            categoryList.innerHTML = `
                <div class="category-item ${selectedCategory === 'all' ? 'active' : ''}" onclick="selectCategory('all')">
                    <span>ğŸ“‹ ã™ã¹ã¦</span>
                    <span class="category-badge">${threads.length}</span>
                </div>
            ` + categories.map(cat => {
                const count = threads.filter(t => t.category === cat.id).length;
                return `
                    <div class="category-item ${selectedCategory === cat.id ? 'active' : ''}" onclick="selectCategory('${cat.id}')">
                        <span>${cat.name}</span>
                        ${count > 0 ? `<span class="category-badge">${count}</span>` : ''}
                    </div>
                `;
            }).join('');
        }

        // ã‚«ãƒ†ã‚´ãƒªé¸æŠ
        function selectCategory(categoryId) {
            selectedCategory = categoryId;
            renderCategories();
            renderThreads();
        }

        // ã‚¹ãƒ¬ãƒƒãƒ‰è¡¨ç¤º
        function renderThreads() {
            const threadsList = document.getElementById('threadsList');
            const filteredThreads = selectedCategory === 'all' 
                ? threads 
                : threads.filter(t => t.category === selectedCategory);

            if (filteredThreads.length === 0) {
                threadsList.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: #999;">
                        <p style="font-size: 48px;">ğŸ“­</p>
                        <p>ã“ã®ã‚«ãƒ†ã‚´ãƒªã«ã¯æŠ•ç¨¿ãŒã‚ã‚Šã¾ã›ã‚“</p>
                    </div>
                `;
                return;
            }

            threadsList.innerHTML = filteredThreads.map(thread => {
                const category = categories.find(c => c.id === thread.category);
                return `
                    <div class="thread-card" onclick="openThreadDetail(${thread.id})">
                        <div class="thread-header">
                            <div style="flex: 1;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
                                    <h3 class="thread-title">${thread.title}</h3>
                                    ${thread.isNew ? '<span class="new-badge">NEW</span>' : ''}
                                </div>
                                <div class="thread-meta">
                                    <span class="thread-author">ğŸ‘¤ ${thread.author}</span>
                                    <span class="thread-date">ğŸ•’ ${thread.date}</span>
                                </div>
                            </div>
                            <span class="thread-category-tag">${category?.name || ''}</span>
                        </div>
                        <div class="thread-content">
                            ${thread.content}
                        </div>
                        <div class="thread-footer">
                            <div class="thread-stats">
                                <span class="stat-item">ğŸ’¬ ${thread.replies} ä»¶ã®è¿”ä¿¡</span>
                                <span class="stat-item">ğŸ‘ï¸ ${thread.views} é–²è¦§</span>
                                ${thread.hasAttachment ? '<span class="stat-item attachment-icon">ğŸ“ æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚ã‚Š</span>' : ''}
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // æ–°è¦æŠ•ç¨¿ãƒ¢ãƒ¼ãƒ€ãƒ«
        function openNewThreadModal() {
            document.getElementById('newThreadModal').classList.add('active');
        }

        function closeNewThreadModal() {
            document.getElementById('newThreadModal').classList.remove('active');
            document.getElementById('newThreadForm').reset();
            document.getElementById('fileName').textContent = '';
        }

        // ã‚«ãƒ†ã‚´ãƒªç®¡ç†ãƒ¢ãƒ¼ãƒ€ãƒ«
        function openCategoryModal() {
            document.getElementById('categoryModal').classList.add('active');
            renderCategoryEditList();
        }

        function closeCategoryModal() {
            document.getElementById('categoryModal').classList.remove('active');
        }

        function renderCategoryEditList() {
            const list = document.getElementById('categoryEditList');
            list.innerHTML = categories.map(cat => `
                <li class="category-edit-item">
                    <input type="text" value="${cat.name}" id="cat-${cat.id}">
                    <button class="btn btn-danger" onclick="deleteCategory('${cat.id}')">å‰Šé™¤</button>
                </li>
            `).join('');
        }

        function addNewCategory() {
            const input = document.getElementById('newCategoryName');
            const name = input.value.trim();
            if (!name) {
                alert('ã‚«ãƒ†ã‚´ãƒªåã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            const newId = 'cat_' + Date.now();
            categories.push({ id: newId, name: name, count: 0 });
            input.value = '';
            renderCategoryEditList();
            renderCategories();
            updateCategorySelect();
            alert('ã‚«ãƒ†ã‚´ãƒªã‚’è¿½åŠ ã—ã¾ã—ãŸ');
        }

        function deleteCategory(categoryId) {
            if (!confirm('ã“ã®ã‚«ãƒ†ã‚´ãƒªã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) return;
            categories = categories.filter(c => c.id !== categoryId);
            renderCategoryEditList();
            renderCategories();
            updateCategorySelect();
            alert('ã‚«ãƒ†ã‚´ãƒªã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
        }

        function updateCategorySelect() {
            const select = document.getElementById('threadCategory');
            select.innerHTML = categories.map(cat => 
                `<option value="${cat.id}">${cat.name}</option>`
            ).join('');
        }

        // æ–°è¦æŠ•ç¨¿ä½œæˆ
        function createNewThread() {
            const category = document.getElementById('threadCategory').value;
            const title = document.getElementById('threadTitle').value;
            const content = document.getElementById('threadContent').value;
            const file = document.getElementById('threadFile').files[0];

            const newThread = {
                id: threads.length + 1,
                category: category,
                title: title,
                author: currentUser.name,
                date: new Date().toLocaleString('ja-JP'),
                content: content,
                replies: 0,
                views: 0,
                hasAttachment: !!file,
                isNew: true
            };

            threads.unshift(newThread);
            closeNewThreadModal();
            renderThreads();
            renderCategories();
            alert('æŠ•ç¨¿ã‚’ä½œæˆã—ã¾ã—ãŸï¼');
        }

        // ã‚¹ãƒ¬ãƒƒãƒ‰è©³ç´°è¡¨ç¤º
        function openThreadDetail(threadId) {
            const thread = threads.find(t => t.id === threadId);
            if (!thread) return;

            document.getElementById('detailThreadTitle').textContent = thread.title;
            document.getElementById('threadDetailContent').innerHTML = `
                <div style="padding: 20px; border: 1px solid #eee; border-radius: 5px; margin-bottom: 20px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 15px;">
                        <div>
                            <strong>ğŸ‘¤ ${thread.author}</strong>
                            <span style="color: #999; margin-left: 10px;">ğŸ•’ ${thread.date}</span>
                        </div>
                        ${currentUser.role === 'admin' ? '<button class="btn btn-danger btn-sm" onclick="deleteThread(' + thread.id + ')">ğŸ—‘ï¸ å‰Šé™¤</button>' : ''}
                    </div>
                    <p style="line-height: 1.8;">${thread.content}</p>
                    ${thread.hasAttachment ? '<p style="margin-top: 15px; color: #2196F3;">ğŸ“ æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«: sample_document.pdf</p>' : ''}
                </div>
                <div style="margin-top: 20px;">
                    <h3 style="margin-bottom: 15px;">ğŸ’¬ è¿”ä¿¡ (${thread.replies}ä»¶)</h3>
                    <div style="padding: 15px; background: #f9f9f9; border-radius: 5px; margin-bottom: 10px;">
                        <div style="margin-bottom: 10px;">
                            <strong>ç”°ä¸­æ¬¡éƒ</strong>
                            <span style="color: #999; margin-left: 10px; font-size: 13px;">2026-02-04 10:15</span>
                        </div>
                        <p>äº†è§£ã—ã¾ã—ãŸã€‚äº‹å‰ã«æº–å‚™ã—ã¦ãŠãã¾ã™ã€‚</p>
                    </div>
                    <div style="padding: 15px; background: #f9f9f9; border-radius: 5px;">
                        <div style="margin-bottom: 10px;">
                            <strong>ä½è—¤èŠ±å­</strong>
                            <span style="color: #999; margin-left: 10px; font-size: 13px;">2026-02-04 11:30</span>
                        </div>
                        <p>è©³ç´°ãªæƒ…å ±ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚</p>
                    </div>
                </div>
                <div style="margin-top: 20px;">
                    <textarea placeholder="è¿”ä¿¡ã‚’å…¥åŠ›..." style="width: 100%; min-height: 100px; padding: 10px; border: 1px solid #ddd; border-radius: 5px;"></textarea>
                    <button class="btn btn-primary" style="margin-top: 10px;">è¿”ä¿¡ã™ã‚‹</button>
                </div>
            `;
            document.getElementById('threadDetailModal').classList.add('active');
        }

        function closeThreadDetailModal() {
            document.getElementById('threadDetailModal').classList.remove('active');
        }

        function deleteThread(threadId) {
            if (!confirm('ã“ã®æŠ•ç¨¿ã‚’å‰Šé™¤ã—ã¦ã‚‚ã‚ˆã‚ã—ã„ã§ã™ã‹ï¼Ÿ')) return;
            threads = threads.filter(t => t.id !== threadId);
            closeThreadDetailModal();
            renderThreads();
            renderCategories();
            alert('æŠ•ç¨¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
        }
    </script>
</body>
</html>
